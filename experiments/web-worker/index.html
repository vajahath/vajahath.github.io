<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Web worker experiments | No WW</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/dark.min.css"><link rel="stylesheet" href="style.css"></head><body><h1>Web worker experiments (Has Worker)</h1><h2>This page has web worker. <a style="color:salmon" href="./without-worker.html">See without web worker implementation</a></h2><hr><br><br><progress id="progress" value="0" max="1000"></progress><br><span>Time elapsed in last run: <strong id="timeField">N/A</strong> sec</span><br><br><button id="burner">Burn CPU</button> (Clicking this button runs a CPU intensive task off the main thread)<br><h3>What is this?</h3><p>Clicking this button run a high CPU intensive task. This implementation is with using web worker. This is to show the difference in UX between with and without using web workers. The above button will run the following function.</p><pre><code id="mainFunctionPreview"></code></pre><p>See code <a style="color:salmon" href="https://github.com/vajahath/vajahath.github.io/tree/master/src/experiments/web-worker">github.com/vajahath/.../web-worker</a></p><script type="module">import prettier from"https://unpkg.com/prettier@2.5.1/esm/standalone.mjs";import parserBabel from"https://unpkg.com/prettier@2.5.1/esm/parser-babel.mjs";import*as Comlink from"https://unpkg.com/comlink/dist/esm/comlink.mjs";{const e=new Worker("./worker.js");Comlink.wrap(e).test.then(e=>console.log("Worker connected! Message from worker:",e)).catch(e=>console.error(e))}const burnerButton=document.getElementById("burner"),timeField=document.getElementById("timeField"),mainFunctionPreview=document.getElementById("mainFunctionPreview");mainFunctionPreview.innerText=prettier.format(buttonClick.toString(),{parser:"babel",plugins:[parserBabel]}),burnerButton.addEventListener("click",()=>{disableButton(),buttonClick()});const progressBar=document.getElementById("progress"),totalNumberOfTasks=1e3;async function buttonClick(){resetTimeField(),disableButton(),updateProgressBar(0);const e=Date.now(),t=new Worker("./worker.js"),n=Comlink.wrap(t),r=getListOfTasksTodo();for(const e of r){updateProgressBar(await n.executeTask(e))}const o=Date.now();enableButton(),updateTimeFieldAtLast(e,o)}function getListOfTasksTodo(){return Array.from({length:1e3}).map((e,t)=>t+1)}function disableButton(){burnerButton.disabled=!0}function enableButton(){burnerButton.disabled=!1}function updateProgressBar(e){progressBar.value=e}function resetTimeField(){timeField.innerText="--"}function updateTimeFieldAtLast(e,t){const n=(t-e)/1e3;timeField.innerText=n.toString()}progressBar.max=1e3</script></body></html>